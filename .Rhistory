geom_point(size = 3, stroke=.25) + scale_shape_manual(values=shapes) +
scale_fill_manual(values=cols) + scale_color_manual(values=contour) +
scale_x_continuous(limits=c(-6, 6)) + scale_y_continuous(limits=c(-1.5, 2.7)) +
theme(panel.border = element_rect(colour = "black", fill=NA, size=.5),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_rect(fill = "white"), title = element_blank(),
axis.title = element_text(size = 9), axis.text = element_text(size = 8),
legend.position = "none", aspect.ratio=1) +
labs(x=paste0("PC1 (",round(eig["Dim.1","variance.percent"], digits = 1),"%)"),
y=paste0("PC2 (",round(eig["Dim.2","variance.percent"], digits = 1),"%)"))
K1226_PCA_2b
View(d_pca)
#### Fig 4h ####
## K1226 PCA 2
OIB <- q19 %>% dplyr::select(
Sample,Location,SiO2,Al2O3,MgO,CaO,V,Rb,Ba,Th,U,Nb,La,Ce,Nd,Sr,Sm,Zr,Y,Yb,Pb)
#Sample,Location,SiO2,K2O,Na2O,Rb,Ba,Th,U,Nb,La,Ce,Nd,Sr,Sm,Zr,Hf,Eu,Yb)
is.na(OIB) <- sapply(OIB, is.infinite) #replace Inf by NA
OIB[OIB == 0] <- NA # Replace 0 with NA
OIB <- OIB[rowSums(is.na(OIB)) == 0,] # removes rows with missing info for PCA
s <- joined_data %>%
dplyr::filter(Sample %in% c("K-12-26")) %>%
mutate(Location = case_when(grepl("K-12-26", Sample) ~ "K-12-26")) %>%
dplyr::select(
Sample,Location,SiO2,Al2O3,MgO,CaO,V,Rb,Ba,Th,U,Nb,La,Ce,Nd,Sr,Sm,Zr,Y,Yb,Pb)
#Sample,Location,SiO2,K2O,Na2O,Rb,Ba,Th,U,Nb,La,Ce,Nd,Sr,Sm,Zr,Hf,Eu,Yb)
s[s == 0] <- NA # Replace 0 with NA
s <- s[rowSums(is.na(s)) == 0,] # removes rows with missing info for PCA
#res.pca <- prcomp(OIB[,3:19], scale = TRUE, center = TRUE) # Dimension reduction using PCA
res.pca <- prcomp(OIB[,3:21], scale = TRUE, center = TRUE) # Dimension reduction using PCA
eig <- get_eig(res.pca)
K1226_PCA_2a <- fviz_pca_biplot(
res.pca, label = "var", col.var = "black", alpha.var = .2,
habillage = OIB$Location, fill.ind = OIB$Location,
pointsize = 2, invisible = "quali", labelsize = 3, repel = T) +
scale_shape_manual(values=shapes) + scale_fill_manual(values=cols) +
scale_color_manual(values=cols) +
scale_x_continuous(limits=c(-6, 6)) + scale_y_continuous(limits=c(-1.5, 2.7)) +
theme(panel.border = element_rect(colour = "black", fill=NA, size=1),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_rect(fill = "white"), title = element_blank(),
axis.title = element_text(size = 10), axis.text = element_text(size = 10),
legend.title = element_blank(), legend.text = element_text(size = 10),
legend.key.size = unit(.2, 'cm'), legend.position = "none", aspect.ratio=1)
K1226_PCA_2a
K1226_PCA_2a <- fviz_pca_biplot(
res.pca, label = "var", col.var = "black", alpha.var = .2,
habillage = OIB$Location, fill.ind = OIB$Location,
pointsize = 2, invisible = "quali", labelsize = 3, repel = T) +
scale_shape_manual(values=shapes) + scale_fill_manual(values=cols) +
scale_color_manual(values=cols) +
#scale_x_continuous(limits=c(-6, 6)) + scale_y_continuous(limits=c(-1.5, 2.7)) +
theme(panel.border = element_rect(colour = "black", fill=NA, size=1),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_rect(fill = "white"), title = element_blank(),
axis.title = element_text(size = 10), axis.text = element_text(size = 10),
legend.title = element_blank(), legend.text = element_text(size = 10),
legend.key.size = unit(.2, 'cm'), legend.position = "none", aspect.ratio=1)
K1226_PCA_2a
#pred <- stats::predict(res.pca, s[,3:19])
pred <- stats::predict(res.pca, s[,3:21])
pred <- cbind(s[,1:2], pred)
res.pca.df <- cbind(OIB[,1:2], (as.data.frame(res.pca$x)))
d_pca <- full_join(res.pca.df, pred)
K1226_PCA_2b <- d_pca %>%
ggplot(aes(x=PC1,y=PC2, shape=factor(Location), fill=factor(Location),
color=factor(Location), group=Sample)) +
geom_vline(aes(xintercept = 0), size=.25, linetype="dashed") +
geom_hline(aes(yintercept = 0), size=.25, linetype="dashed") +
geom_point(size = 3, stroke=.25) + scale_shape_manual(values=shapes) +
scale_fill_manual(values=cols) + scale_color_manual(values=contour) +
scale_x_continuous(limits=c(-6, 6)) + scale_y_continuous(limits=c(-1.5, 2.7)) +
theme(panel.border = element_rect(colour = "black", fill=NA, size=.5),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_rect(fill = "white"), title = element_blank(),
axis.title = element_text(size = 9), axis.text = element_text(size = 8),
legend.position = "none", aspect.ratio=1) +
labs(x=paste0("PC1 (",round(eig["Dim.1","variance.percent"], digits = 1),"%)"),
y=paste0("PC2 (",round(eig["Dim.2","variance.percent"], digits = 1),"%)"))
K1226_PCA_2b
K1226_PCA_2b <- d_pca %>%
ggplot(aes(x=PC1,y=PC2, shape=factor(Location), fill=factor(Location),
color=factor(Location), group=Sample)) +
geom_vline(aes(xintercept = 0), size=.25, linetype="dashed") +
geom_hline(aes(yintercept = 0), size=.25, linetype="dashed") +
geom_point(size = 3, stroke=.25) + scale_shape_manual(values=shapes) +
scale_fill_manual(values=cols) + scale_color_manual(values=contour) +
#scale_x_continuous(limits=c(-6, 6)) + scale_y_continuous(limits=c(-1.5, 2.7)) +
theme(panel.border = element_rect(colour = "black", fill=NA, size=.5),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_rect(fill = "white"), title = element_blank(),
axis.title = element_text(size = 9), axis.text = element_text(size = 8),
legend.position = "none", aspect.ratio=1) +
labs(x=paste0("PC1 (",round(eig["Dim.1","variance.percent"], digits = 1),"%)"),
y=paste0("PC2 (",round(eig["Dim.2","variance.percent"], digits = 1),"%)"))
K1226_PCA_2b
# PC values > distance to artefacts (individual or median of group)
# distance within all PCs > weight mean distance
dist <- data.frame(
Sample = c(d_pca[1:13,"Sample"]),
Location = c(d_pca[1:13,"Location"]),
PC1 = c(sqrt(((d_pca[14,"PC1"])-d_pca[1:13,"PC1"])^2)),
PC2 = c(sqrt(((d_pca[14,"PC2"])-d_pca[1:13,"PC2"])^2)),
PC3 = c(sqrt(((d_pca[14,"PC3"])-d_pca[1:13,"PC3"])^2)),
PC4 = c(sqrt(((d_pca[14,"PC4"])-d_pca[1:13,"PC4"])^2)),
PC5 = c(sqrt(((d_pca[14,"PC5"])-d_pca[1:13,"PC5"])^2)),
PC6 = c(sqrt(((d_pca[14,"PC6"])-d_pca[1:13,"PC6"])^2)),
PC7 = c(sqrt(((d_pca[14,"PC7"])-d_pca[1:13,"PC7"])^2)),
PC8 = c(sqrt(((d_pca[14,"PC8"])-d_pca[1:13,"PC8"])^2)),
PC9 = c(sqrt(((d_pca[14,"PC9"])-d_pca[1:13,"PC9"])^2)),
PC10 = c(sqrt(((d_pca[14,"PC10"])-d_pca[1:13,"PC10"])^2)),
PC11 = c(sqrt(((d_pca[14,"PC11"])-d_pca[1:13,"PC11"])^2)),
PC12 = c(sqrt(((d_pca[14,"PC12"])-d_pca[1:13,"PC12"])^2)),
PC13 = c(sqrt(((d_pca[14,"PC13"])-d_pca[1:13,"PC13"])^2)),
PC14 = c(sqrt(((d_pca[14,"PC14"])-d_pca[1:13,"PC14"])^2)),
PC15 = c(sqrt(((d_pca[14,"PC15"])-d_pca[1:13,"PC15"])^2)),
PC16 = c(sqrt(((d_pca[14,"PC16"])-d_pca[1:13,"PC16"])^2)),
PC17 = c(sqrt(((d_pca[14,"PC17"])-d_pca[1:13,"PC17"])^2)),
PC18 = c(sqrt(((d_pca[14,"PC18"])-d_pca[1:13,"PC18"])^2)),
PC19 = c(sqrt(((d_pca[14,"PC19"])-d_pca[1:13,"PC19"])^2))) %>%
mutate(weight_mean = (
(PC1*eig[1,2])+(PC2*eig[2,2])+(PC3*eig[3,2])+(PC4*eig[4,2])+(PC5*eig[5,2])+
(PC6*eig[6,2])+(PC7*eig[7,2])+(PC8*eig[8,2])+(PC9*eig[9,2])+
(PC10*eig[10,2])+(PC11*eig[11,2])+(PC12*eig[12,2])+(PC13*eig[13,2])+
(PC14*eig[14,2])+(PC15*eig[15,2])+(PC16*eig[16,2])+(PC17*eig[17,2])+
(PC18*eig[18,2])+(PC19*eig[19,2])) / (sum(eig[1:19,2])))
View(dist)
d_pca
View(d_pca)
# PC values > distance to artefacts (individual or median of group)
# distance within all PCs > weight mean distance
dist <- data.frame(
Sample = c(d_pca[1:12,"Sample"]),
Location = c(d_pca[1:12,"Location"]),
PC1 = c(sqrt(((d_pca[13,"PC1"])-d_pca[1:12,"PC1"])^2)),
PC2 = c(sqrt(((d_pca[13,"PC2"])-d_pca[1:12,"PC2"])^2)),
PC3 = c(sqrt(((d_pca[13,"PC3"])-d_pca[1:12,"PC3"])^2)),
PC4 = c(sqrt(((d_pca[13,"PC4"])-d_pca[1:12,"PC4"])^2)),
PC5 = c(sqrt(((d_pca[13,"PC5"])-d_pca[1:12,"PC5"])^2)),
PC6 = c(sqrt(((d_pca[13,"PC6"])-d_pca[1:12,"PC6"])^2)),
PC7 = c(sqrt(((d_pca[13,"PC7"])-d_pca[1:12,"PC7"])^2)),
PC8 = c(sqrt(((d_pca[13,"PC8"])-d_pca[1:12,"PC8"])^2)),
PC9 = c(sqrt(((d_pca[13,"PC9"])-d_pca[1:12,"PC9"])^2)),
PC10 = c(sqrt(((d_pca[13,"PC10"])-d_pca[1:12,"PC10"])^2)),
PC11 = c(sqrt(((d_pca[13,"PC11"])-d_pca[1:12,"PC11"])^2)),
PC12 = c(sqrt(((d_pca[13,"PC12"])-d_pca[1:12,"PC12"])^2)),
PC12 = c(sqrt(((d_pca[13,"PC12"])-d_pca[1:12,"PC12"])^2)),
PC13 = c(sqrt(((d_pca[13,"PC13"])-d_pca[1:12,"PC13"])^2)),
PC15 = c(sqrt(((d_pca[13,"PC15"])-d_pca[1:12,"PC15"])^2)),
PC16 = c(sqrt(((d_pca[13,"PC16"])-d_pca[1:12,"PC16"])^2)),
PC17 = c(sqrt(((d_pca[13,"PC17"])-d_pca[1:12,"PC17"])^2)),
PC18 = c(sqrt(((d_pca[13,"PC18"])-d_pca[1:12,"PC18"])^2)),
PC19 = c(sqrt(((d_pca[13,"PC19"])-d_pca[1:12,"PC19"])^2))) %>%
mutate(weight_mean = (
(PC1*eig[1,2])+(PC2*eig[2,2])+(PC3*eig[3,2])+(PC4*eig[4,2])+(PC5*eig[5,2])+
(PC6*eig[6,2])+(PC7*eig[7,2])+(PC8*eig[8,2])+(PC9*eig[9,2])+
(PC10*eig[10,2])+(PC11*eig[11,2])+(PC12*eig[12,2])+(PC13*eig[13,2])+
(PC14*eig[14,2])+(PC15*eig[15,2])+(PC16*eig[16,2])+(PC17*eig[17,2])+
(PC18*eig[18,2])+(PC19*eig[19,2])) / (sum(eig[1:19,2])))
View(d_pca)
#res.pca <- prcomp(OIB[,3:19], scale = TRUE, center = TRUE) # Dimension reduction using PCA
res.pca <- prcomp(OIB[,3:21], scale = TRUE, center = TRUE) # Dimension reduction using PCA
#### Fig 4h ####
## K1226 PCA 2
OIB <- q19 %>% dplyr::select(
Sample,Location,SiO2,Al2O3,MgO,CaO,V,Rb,Ba,Th,U,Nb,La,Ce,Nd,Sr,Sm,Zr,Y,Yb,Pb)
#Sample,Location,SiO2,K2O,Na2O,Rb,Ba,Th,U,Nb,La,Ce,Nd,Sr,Sm,Zr,Hf,Eu,Yb)
is.na(OIB) <- sapply(OIB, is.infinite) #replace Inf by NA
OIB[OIB == 0] <- NA # Replace 0 with NA
OIB <- OIB[rowSums(is.na(OIB)) == 0,] # removes rows with missing info for PCA
s <- joined_data %>%
dplyr::filter(Sample %in% c("K-12-26")) %>%
mutate(Location = case_when(grepl("K-12-26", Sample) ~ "K-12-26")) %>%
dplyr::select(
Sample,Location,SiO2,Al2O3,MgO,CaO,V,Rb,Ba,Th,U,Nb,La,Ce,Nd,Sr,Sm,Zr,Y,Yb,Pb)
#Sample,Location,SiO2,K2O,Na2O,Rb,Ba,Th,U,Nb,La,Ce,Nd,Sr,Sm,Zr,Hf,Eu,Yb)
s[s == 0] <- NA # Replace 0 with NA
s <- s[rowSums(is.na(s)) == 0,] # removes rows with missing info for PCA
#res.pca <- prcomp(OIB[,3:19], scale = TRUE, center = TRUE) # Dimension reduction using PCA
res.pca <- prcomp(OIB[,3:21], scale = TRUE, center = TRUE) # Dimension reduction using PCA
eig <- get_eig(res.pca)
K1226_PCA_2a <- fviz_pca_biplot(
res.pca, label = "var", col.var = "black", alpha.var = .2,
habillage = OIB$Location, fill.ind = OIB$Location,
pointsize = 2, invisible = "quali", labelsize = 3, repel = T) +
scale_shape_manual(values=shapes) + scale_fill_manual(values=cols) +
scale_color_manual(values=cols) +
#scale_x_continuous(limits=c(-6, 6)) + scale_y_continuous(limits=c(-1.5, 2.7)) +
theme(panel.border = element_rect(colour = "black", fill=NA, size=1),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_rect(fill = "white"), title = element_blank(),
axis.title = element_text(size = 10), axis.text = element_text(size = 10),
legend.title = element_blank(), legend.text = element_text(size = 10),
legend.key.size = unit(.2, 'cm'), legend.position = "none", aspect.ratio=1)
K1226_PCA_2a
pdf(here("analysis","figures","Figure_4","Fig4-h-PCA.pdf"), width=3.5, height=3.5)
K1226_PCA_2a
dev.off()
#pred <- stats::predict(res.pca, s[,3:19])
pred <- stats::predict(res.pca, s[,3:21])
pred <- cbind(s[,1:2], pred)
res.pca.df <- cbind(OIB[,1:2], (as.data.frame(res.pca$x)))
d_pca <- full_join(res.pca.df, pred)
View(d_pca)
#pred <- stats::predict(res.pca, s[,3:19])
pred <- stats::predict(res.pca, s[,3:21])
pred <- cbind(s[,1:2], pred)
res.pca.df <- cbind(OIB[,1:2], (as.data.frame(res.pca$x)))
d_pca <- full_join(res.pca.df, pred)
#pred <- stats::predict(res.pca, s[,3:19])
pred <- stats::predict(res.pca, s[,3:21])
pred <- cbind(s[,1:2], pred)
View(pred)
s[,3:21]
#pred <- stats::predict(res.pca, s[,3:19])
pred <- stats::predict(res.pca, s[,3:21])
pred <- cbind(s[,1:2], pred)
res.pca.df <- cbind(OIB[,1:2], (as.data.frame(res.pca$x)))
d_pca <- full_join(res.pca.df, pred)
res.pca.df <- cbind(OIB[,1:2], (as.data.frame(res.pca$x)))
View(res.pca.df)
res.pca
#res.pca <- prcomp(OIB[,3:19], scale = TRUE, center = TRUE) # Dimension reduction using PCA
res.pca <- prcomp(OIB[,3:21], scale = TRUE, center = TRUE) # Dimension reduction using PCA
OIB <- q17 %>% dplyr::select(
Sample,Location,SiO2,Al2O3,MgO,CaO,V,Rb,Ba,Th,U,Nb,La,Ce,Nd,Sr,Sm,Zr,Y,Yb,Pb)
#Sample,Location,TiO2,Al2O3,MgO,CaO,V,Rb,Sr,Y,Zr,Nb,Cs,Ba,La,Ce,Nd,Eu,Yb,Hf,Ta,Pb,Th,U)
is.na(OIB) <- sapply(OIB, is.infinite) #replace Inf by NA
OIB[OIB == 0] <- NA # Replace 0 with NA
OIB <- OIB[rowSums(is.na(OIB)) == 0,] # removes rows with missing info for PCA
OIB %>% group_by(Location) %>% tally()
s <- joined_data %>% dplyr::filter(Sample %in% c("K-12-25")) %>%
mutate(Location = case_when(grepl("K-12-25", Sample) ~ "K-12-25")) %>%
dplyr::select(
Sample,Location,SiO2,Al2O3,MgO,CaO,V,Rb,Ba,Th,U,Nb,La,Ce,Nd,Sr,Sm,Zr,Y,Yb,Pb)
#Sample,Location,TiO2,Al2O3,MgO,CaO,V,Rb,Sr,Y,Zr,Nb,Cs,Ba,La,Ce,Nd,Eu,Yb,Hf,Ta,Pb,Th,U)
s[s == 0] <- NA # Replace 0 with NA
s <- s[rowSums(is.na(s)) == 0,] # removes rows with missing info for PCA
res.pca <- prcomp(OIB[,3:21], scale = TRUE, center = TRUE) # Dimension reduction using PCA
eig <- get_eig(res.pca)
K1225_PCA_2a <- fviz_pca_biplot(
res.pca, label = "var", col.var = "black", alpha.var = .2,
habillage = OIB$Location, fill.ind = OIB$Location,
pointsize = 2, invisible = "quali", labelsize = 3, repel = T) +
scale_shape_manual(values=shapes) + scale_fill_manual(values=cols) +
scale_color_manual(values=cols) +
scale_x_continuous(limits=c(-7, 9)) + scale_y_continuous(limits=c(-3.5, 3.5)) +
theme(panel.border = element_rect(colour = "black", fill=NA, size=1),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_rect(fill = "white"), title = element_blank(),
axis.title = element_text(size = 10), axis.text = element_text(size = 10),
legend.title = element_blank(), legend.text = element_text(size = 10),
legend.key.size = unit(.2, 'cm'), legend.position = "none", aspect.ratio=1)
K1225_PCA_2a
pdf(here("analysis","figures","Figure_4","Fig4-f-PCA.pdf"), width=3.5, height=3.5)
K1225_PCA_2a
dev.off()
pred <- stats::predict(res.pca, s[,3:21])
pred <- cbind(s[,1:2], pred)
res.pca.df <- cbind(OIB[,1:2], (as.data.frame(res.pca$x)))
d_pca <- full_join(res.pca.df, pred)
View(ranges_s_OIB)
View(d_pca)
OIB <- q17 %>% dplyr::select(
Sample,Location,SiO2,Al2O3,MgO,CaO,V,Rb,Ba,Th,U,Nb,La,Ce,Nd,Sr,Sm,Zr,Y,Yb,Pb)
is.na(OIB) <- sapply(OIB, is.infinite) #replace Inf by NA
OIB[OIB == 0] <- NA # Replace 0 with NA
OIB <- OIB[rowSums(is.na(OIB)) == 0,] # removes rows with missing info for PCA
OIB %>% group_by(Location) %>% tally()
s <- joined_data %>% dplyr::filter(Sample %in% c("K-12-25")) %>%
mutate(Location = case_when(grepl("K-12-25", Sample) ~ "K-12-25")) %>%
dplyr::select(
Sample,Location,SiO2,Al2O3,MgO,CaO,V,Rb,Ba,Th,U,Nb,La,Ce,Nd,Sr,Sm,Zr,Y,Yb,Pb)
s[s == 0] <- NA # Replace 0 with NA
s <- s[rowSums(is.na(s)) == 0,] # removes rows with missing info for PCA
res.pca <- prcomp(OIB[,3:21], scale = TRUE, center = TRUE) # Dimension reduction using PCA
eig <- get_eig(res.pca)
K1225_PCA_2a <- fviz_pca_biplot(
res.pca, label = "var", col.var = "black", alpha.var = .2,
habillage = OIB$Location, fill.ind = OIB$Location,
pointsize = 2, invisible = "quali", labelsize = 3, repel = T) +
scale_shape_manual(values=shapes) + scale_fill_manual(values=cols) +
scale_color_manual(values=cols) +
scale_x_continuous(limits=c(-7, 9)) + scale_y_continuous(limits=c(-3.5, 3.5)) +
theme(panel.border = element_rect(colour = "black", fill=NA, size=1),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_rect(fill = "white"), title = element_blank(),
axis.title = element_text(size = 10), axis.text = element_text(size = 10),
legend.title = element_blank(), legend.text = element_text(size = 10),
legend.key.size = unit(.2, 'cm'), legend.position = "none", aspect.ratio=1)
K1225_PCA_2a
pdf(here("analysis","figures","Figure_4","Fig4-f-PCA.pdf"), width=3.5, height=3.5)
K1225_PCA_2a
dev.off()
pred <- stats::predict(res.pca, s[,3:21])
pred <- cbind(s[,1:2], pred)
res.pca.df <- cbind(OIB[,1:2], (as.data.frame(res.pca$x)))
d_pca <- full_join(res.pca.df, pred)
K1225_PCA_2b <- d_pca %>%
ggplot(aes(x=PC1,y=PC2, shape=factor(Location), fill=factor(Location),
color=factor(Location), group=Sample)) +
geom_vline(aes(xintercept = 0), size=.25, linetype="dashed") +
geom_hline(aes(yintercept = 0), size=.25, linetype="dashed") +
geom_point(size = 3, stroke=.25) + scale_shape_manual(values=shapes) +
scale_fill_manual(values=cols) + scale_color_manual(values=contour) +
scale_x_continuous(limits=c(-7, 9)) + scale_y_continuous(limits=c(-3.5, 3.5)) +
theme(panel.border = element_rect(colour = "black", fill=NA, size=.5),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_rect(fill = "white"), title = element_blank(),
axis.title = element_text(size = 9), axis.text = element_text(size = 8),
legend.position = "none", aspect.ratio=1) +
labs(x=paste0("PC1 (",round(eig["Dim.1","variance.percent"], digits = 1),"%)"),
y=paste0("PC2 (",round(eig["Dim.2","variance.percent"], digits = 1),"%)"))
K1225_PCA_2b
# PC values > distance to artefacts (individual or median of group)
# distance within all PCs > weight mean distance
dist <- data.frame(
Sample = c(d_pca[1:30,"Sample"]),
Location = c(d_pca[1:30,"Location"]),
PC1 = c(sqrt(((d_pca[31,"PC1"])-d_pca[1:30,"PC1"])^2)),
PC2 = c(sqrt(((d_pca[31,"PC2"])-d_pca[1:30,"PC2"])^2)),
PC3 = c(sqrt(((d_pca[31,"PC3"])-d_pca[1:30,"PC3"])^2)),
PC4 = c(sqrt(((d_pca[31,"PC4"])-d_pca[1:30,"PC4"])^2)),
PC5 = c(sqrt(((d_pca[31,"PC5"])-d_pca[1:30,"PC5"])^2)),
PC6 = c(sqrt(((d_pca[31,"PC6"])-d_pca[1:30,"PC6"])^2)),
PC7 = c(sqrt(((d_pca[31,"PC7"])-d_pca[1:30,"PC7"])^2)),
PC8 = c(sqrt(((d_pca[31,"PC8"])-d_pca[1:30,"PC8"])^2)),
PC9 = c(sqrt(((d_pca[31,"PC9"])-d_pca[1:30,"PC9"])^2)),
PC10 = c(sqrt(((d_pca[31,"PC10"])-d_pca[1:30,"PC10"])^2)),
PC11 = c(sqrt(((d_pca[31,"PC11"])-d_pca[1:30,"PC11"])^2)),
PC12 = c(sqrt(((d_pca[31,"PC12"])-d_pca[1:30,"PC12"])^2)),
PC13 = c(sqrt(((d_pca[31,"PC13"])-d_pca[1:30,"PC13"])^2)),
PC14 = c(sqrt(((d_pca[31,"PC14"])-d_pca[1:30,"PC14"])^2)),
PC15 = c(sqrt(((d_pca[31,"PC15"])-d_pca[1:30,"PC15"])^2)),
PC16 = c(sqrt(((d_pca[31,"PC16"])-d_pca[1:30,"PC16"])^2)),
PC17 = c(sqrt(((d_pca[31,"PC17"])-d_pca[1:30,"PC17"])^2)),
PC18 = c(sqrt(((d_pca[31,"PC18"])-d_pca[1:30,"PC18"])^2)),
PC19 = c(sqrt(((d_pca[31,"PC19"])-d_pca[1:30,"PC19"])^2))) %>%
mutate(weight_mean = (
(PC1*eig[1,2])+(PC2*eig[2,2])+(PC3*eig[3,2])+(PC4*eig[4,2])+(PC5*eig[5,2])+
(PC6*eig[6,2])+(PC7*eig[7,2])+(PC8*eig[8,2])+(PC9*eig[9,2])+
(PC10*eig[10,2])+(PC11*eig[11,2])+(PC12*eig[12,2])+(PC13*eig[13,2])+
(PC14*eig[14,2])+(PC15*eig[15,2])+(PC16*eig[16,2])+(PC17*eig[17,2])+
(PC18*eig[18,2])+(PC19*eig[19,2])) / (sum(eig[1:19,2])))
# distances > distance index, from 1 (closer to artefact) to 5 (more distant)
# 1= min > (1st quartile/2)
# 2= (1st quartile/2) > 1st quartile
# 3= 1st quartile > median
# 4= median > 3rd quartile
# 5= 3rd quartile > max
summary_stat <- data.frame(unclass(summary(dist$weight_mean)), check.names = F)
dist <- dist %>% mutate(
dist_cat = cut(weight_mean,
breaks=c(0,(summary_stat["1st Qu.",]/2),
summary_stat["1st Qu.",],
summary_stat["Median",],
summary_stat["3rd Qu.",],
summary_stat["Max.",]),
labels=c('1','2','3','4','5')))
distance_index <- ggplot(dist, aes(x = factor(dist_cat), fill=Location)) +
geom_bar(position="fill", alpha=.75) + scale_shape_manual(values=shapes) +
scale_fill_manual(values=cols) + scale_color_manual(values=contour) +
theme_void() + theme(
axis.title.x=element_text(size=9, vjust = -1.5),
axis.text.x=element_text(size=8, vjust = -.5),
axis.title.y=element_blank(),
axis.line.x=element_line(size=.25), axis.ticks.length.x=unit(.1,"cm"),
axis.ticks.x=element_line(size=.25, color="black"), legend.position="none") +
labs(x=paste0("Distance index","\n","(Total variance)"))
distance_index
distance_index <- distance_index/plot_spacer() + plot_layout(heights = c(4,.1))
pdf(here("analysis","figures","Figure_4","Fig4-f.pdf"), width=5.5, height=3.5)
(K1225_PCA_2b | distance_index) + plot_layout(widths = c(4, 2))
dev.off()
## PCs : density plots
PC1 <- ggplot(d_pca, aes(x = PC1, y = 0)) +
geom_density_ridges(aes(color=Location, fill=Location), alpha=0.4, size=.25) +
annotate("segment", x=d_pca[31,"PC1"], xend=d_pca[31,"PC1"],
y=0, yend=Inf, col="red", size=.75) +
scale_color_manual(values = cols) + scale_fill_manual(values = cols) +
scale_x_continuous(expand = c(0, 0)) + scale_y_continuous(expand = c(0, 0)) +
theme_void() + theme(
axis.title.y=element_text(size=7, margin=margin(r=0), hjust = 0),
axis.text.x=element_text(size=6), axis.line.x=element_line(size=.25),
axis.ticks.length.x=unit(.05,"cm"),
axis.ticks.x=element_line(size=.25, color="black"), legend.position="none") +
labs(y=paste0("PC1","\n","(",round(eig["Dim.1","variance.percent"], digits = 1),"%)"))
PC2 <- ggplot(d_pca, aes(x = PC2, y = 0)) +
geom_density_ridges(aes(color=Location, fill=Location), alpha=0.4, size=.25) +
annotate("segment", x=d_pca[31,"PC2"], xend=d_pca[31,"PC2"],
y=0, yend=Inf, col="red", size=.75) +
scale_color_manual(values = cols) + scale_fill_manual(values = cols) +
scale_x_continuous(expand = c(0, 0)) + scale_y_continuous(expand = c(0, 0)) +
theme_void() + theme(
axis.title.y=element_text(size=7, margin=margin(r=0), hjust = 0),
axis.text.x=element_text(size=6), axis.line.x=element_line(size=.25),
axis.ticks.length.x=unit(.05,"cm"),
axis.ticks.x=element_line(size=.25, color="black"), legend.position="none") +
labs(y=paste0("PC2","\n","(",round(eig["Dim.2","variance.percent"], digits = 1),"%)"))
PC3 <- ggplot(d_pca, aes(x = PC3, y = 0)) +
geom_density_ridges(aes(color=Location, fill=Location), alpha=0.4, size=.25) +
annotate("segment", x=d_pca[31,"PC3"], xend=d_pca[31,"PC3"],
y=0, yend=Inf, col="red", size=.75) +
scale_color_manual(values = cols) + scale_fill_manual(values = cols) +
scale_x_continuous(expand = c(0, 0)) + scale_y_continuous(expand = c(0, 0)) +
theme_void() + theme(
axis.title.y=element_text(size=7, margin=margin(r=0), hjust = 0),
axis.text.x=element_text(size=6), axis.line.x=element_line(size=.25),
axis.ticks.length.x=unit(.05,"cm"),
axis.ticks.x=element_line(size=.25, color="black"), legend.position="none") +
labs(y=paste0("PC3","\n","(",round(eig["Dim.3","variance.percent"], digits = 1),"%)"))
PC4 <- ggplot(d_pca, aes(x = PC4, y = 0)) +
geom_density_ridges(aes(color=Location, fill=Location), alpha=0.4, size=.25) +
annotate("segment", x=d_pca[31,"PC4"], xend=d_pca[31,"PC4"],
y=0, yend=Inf, col="red", size=.75) +
scale_color_manual(values = cols) + scale_fill_manual(values = cols) +
scale_x_continuous(expand = c(0, 0)) + scale_y_continuous(expand = c(0, 0)) +
theme_void() + theme(
axis.title.y=element_text(size=7, margin=margin(r=0), hjust = 0),
axis.text.x=element_text(size=6), axis.line.x=element_line(size=.25),
axis.ticks.length.x=unit(.05,"cm"),
axis.ticks.x=element_line(size=.25, color="black"), legend.position="none") +
labs(y=paste0("PC4","\n","(",round(eig["Dim.4","variance.percent"], digits = 1),"%)"))
PC5 <- ggplot(d_pca, aes(x = PC5, y = 0)) +
geom_density_ridges(aes(color=Location, fill=Location), alpha=0.4, size=.25) +
annotate("segment", x=d_pca[31,"PC5"], xend=d_pca[31,"PC5"],
y=0, yend=Inf, col="red", size=.75) +
scale_color_manual(values = cols) + scale_fill_manual(values = cols) +
scale_x_continuous(expand = c(0, 0)) + scale_y_continuous(expand = c(0, 0)) +
theme_void() + theme(
axis.title.y=element_text(size=7, margin=margin(r=0), hjust = 0),
axis.text.x=element_text(size=6), axis.line.x=element_line(size=.25),
axis.ticks.length.x=unit(.05,"cm"),
axis.ticks.x=element_line(size=.25, color="black"), legend.position="none") +
labs(y=paste0("PC5","\n","(",round(eig["Dim.5","variance.percent"], digits = 1),"%)"))
PCs <- PC1/PC2/PC3/PC4/PC5 & theme(plot.margin = unit(c(5,0,5,10), "pt"))
pdf(here("analysis","figures","Figure_4","Fig4-f-SI.pdf"), width=6, height=3.5)
(K1225_PCA_2b | PCs) + plot_layout(widths = c(3.5, 2.5))
dev.off()
#### Fig 4h ####
## K1226 PCA 2
OIB <- q19 %>% dplyr::select(
Sample,Location,SiO2,Al2O3,MgO,CaO,V,Rb,Ba,Th,U,Nb,La,Ce,Nd,Sr,Sm,Zr,Y,Yb,Pb)
is.na(OIB) <- sapply(OIB, is.infinite) #replace Inf by NA
OIB[OIB == 0] <- NA # Replace 0 with NA
OIB <- OIB[rowSums(is.na(OIB)) == 0,] # removes rows with missing info for PCA
s <- joined_data %>%
dplyr::filter(Sample %in% c("K-12-26")) %>%
mutate(Location = case_when(grepl("K-12-26", Sample) ~ "K-12-26")) %>%
dplyr::select(
Sample,Location,SiO2,Al2O3,MgO,CaO,V,Rb,Ba,Th,U,Nb,La,Ce,Nd,Sr,Sm,Zr,Y,Yb,Pb)
s[s == 0] <- NA # Replace 0 with NA
s <- s[rowSums(is.na(s)) == 0,] # removes rows with missing info for PCA
#res.pca <- prcomp(OIB[,3:19], scale = TRUE, center = TRUE) # Dimension reduction using PCA
res.pca <- prcomp(OIB[,3:21], scale = TRUE, center = TRUE) # Dimension reduction using PCA
res.pca
res.pca <- prcomp(OIB[,3:19], scale = TRUE, center = TRUE) # Dimension reduction using PCA
res.pca
OIB[,3:19]
summary(OIB[,3:19])
joined_data
q19
#### Fig 4h ####
## K1226 PCA 2
OIB <- q19 %>% dplyr::select(
Sample,Location,SiO2,Al2O3,MgO,CaO,V,Rb,Ba,Th,U,Nb,La,Ce,Nd,Sr,Sm,Zr,Y,Yb,Pb)
is.na(OIB) <- sapply(OIB, is.infinite) #replace Inf by NA
OIB[OIB == 0] <- NA # Replace 0 with NA
OIB <- OIB[rowSums(is.na(OIB)) == 0,] # removes rows with missing info for PCA
View(OIB)
s <- joined_data %>%
dplyr::filter(Sample %in% c("K-12-26")) %>%
mutate(Location = case_when(grepl("K-12-26", Sample) ~ "K-12-26")) %>%
dplyr::select(
Sample,Location,SiO2,Al2O3,MgO,CaO,V,Rb,Ba,Th,U,Nb,La,Ce,Nd,Sr,Sm,Zr,Y,Yb,Pb)
s[s == 0] <- NA # Replace 0 with NA
s <- s[rowSums(is.na(s)) == 0,] # removes rows with missing info for PCA
View(s)
summary(OIB[,3:21])
res.pca <- prcomp(OIB[,3:21], scale = TRUE, center = TRUE) # Dimension reduction using PCA
res.pca
res.pca <- prcomp(OIB[,3:21], scale = TRUE, center = TRUE) # Dimension reduction using PCA
eig <- get_eig(res.pca)
K1226_PCA_2a <- fviz_pca_biplot(
res.pca, label = "var", col.var = "black", alpha.var = .2,
habillage = OIB$Location, fill.ind = OIB$Location,
pointsize = 2, invisible = "quali", labelsize = 3, repel = T) +
scale_shape_manual(values=shapes) + scale_fill_manual(values=cols) +
scale_color_manual(values=cols) +
#scale_x_continuous(limits=c(-6, 6)) + scale_y_continuous(limits=c(-1.5, 2.7)) +
theme(panel.border = element_rect(colour = "black", fill=NA, size=1),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_rect(fill = "white"), title = element_blank(),
axis.title = element_text(size = 10), axis.text = element_text(size = 10),
legend.title = element_blank(), legend.text = element_text(size = 10),
legend.key.size = unit(.2, 'cm'), legend.position = "none", aspect.ratio=1)
K1226_PCA_2a
pdf(here("analysis","figures","Figure_4","Fig4-h-PCA.pdf"), width=3.5, height=3.5)
K1226_PCA_2a
dev.off()
#pred <- stats::predict(res.pca, s[,3:19])
pred <- stats::predict(res.pca, s[,3:21])
pred <- cbind(s[,1:2], pred)
res.pca.df <- cbind(OIB[,1:2], (as.data.frame(res.pca$x)))
d_pca <- full_join(res.pca.df, pred)
#pred <- stats::predict(res.pca, s[,3:19])
pred <- stats::predict(res.pca, s[,3:21])
View(pred)
pred <- stats::predict(res.pca, s[,3:19])
#pred <- stats::predict(res.pca, s[,3:19])
pred <- stats::predict(res.pca, s[,3:21])
pred
