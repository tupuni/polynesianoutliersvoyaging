axis.ticks.length.x=unit(.05,"cm"),
axis.ticks.x=element_line(size=.25, color="black"), legend.position="none") +
labs(y=paste0("PC2","\n","(",round(eig["Dim.2","variance.percent"], digits = 1),"%)"))
PC3 <- ggplot(d_pca, aes(x = PC3, y = 0)) +
geom_density_ridges(aes(color=Location, fill=Location), alpha=0.4, size=.25) +
annotate("segment", x=d_pca[500,"PC3"], xend=d_pca[500,"PC3"],
y=0, yend=Inf, col="red", size=.75) +
scale_color_manual(values = cols) + scale_fill_manual(values = cols) +
scale_x_continuous(expand = c(0, 0)) + scale_y_continuous(expand = c(0, 0)) +
theme_void() + theme(
axis.title.y=element_text(size=7, margin=margin(r=0), hjust = 0),
axis.text.x=element_text(size=6), axis.line.x=element_line(size=.25),
axis.ticks.length.x=unit(.05,"cm"),
axis.ticks.x=element_line(size=.25, color="black"), legend.position="none") +
labs(y=paste0("PC3","\n","(",round(eig["Dim.3","variance.percent"], digits = 1),"%)"))
PC4 <- ggplot(d_pca, aes(x = PC4, y = 0)) +
geom_density_ridges(aes(color=Location, fill=Location), alpha=0.4, size=.25) +
annotate("segment", x=d_pca[500,"PC4"], xend=d_pca[500,"PC4"],
y=0, yend=Inf, col="red", size=.75) +
scale_color_manual(values = cols) + scale_fill_manual(values = cols) +
scale_x_continuous(expand = c(0, 0)) + scale_y_continuous(expand = c(0, 0)) +
theme_void() + theme(
axis.title.y=element_text(size=7, margin=margin(r=0), hjust = 0),
axis.text.x=element_text(size=6), axis.line.x=element_line(size=.25),
axis.ticks.length.x=unit(.05,"cm"),
axis.ticks.x=element_line(size=.25, color="black"), legend.position="none") +
labs(y=paste0("PC4","\n","(",round(eig["Dim.4","variance.percent"], digits = 1),"%)"))
PC5 <- ggplot(d_pca, aes(x = PC5, y = 0)) +
geom_density_ridges(aes(color=Location, fill=Location), alpha=0.4, size=.25) +
annotate("segment", x=d_pca[500,"PC5"], xend=d_pca[500,"PC5"],
y=0, yend=Inf, col="red", size=.75) +
scale_color_manual(values = cols) + scale_fill_manual(values = cols) +
scale_x_continuous(expand = c(0, 0)) + scale_y_continuous(expand = c(0, 0)) +
theme_void() + theme(
axis.title.y=element_text(size=7, margin=margin(r=0), hjust = 0),
axis.text.x=element_text(size=6), axis.line.x=element_line(size=.25),
axis.ticks.length.x=unit(.05,"cm"),
axis.ticks.x=element_line(size=.25, color="black"), legend.position="none") +
labs(y=paste0("PC5","\n","(",round(eig["Dim.5","variance.percent"], digits = 1),"%)"))
PCs <- PC1/PC2/PC3/PC4/PC5 & theme(plot.margin = unit(c(5,0,5,10), "pt"))
pdf(here("analysis","supplementary-materials","FigS14","FigS14-d.pdf"), width=6, height=3.5)
(K1224_PCA_2b | PCs) + plot_layout(widths = c(3.5, 2.5))
dev.off()
#### FigS14e ####
## K1225 PCA 1
OIB <- q16 %>% dplyr::select(
Sample,Location,Sr87_Sr86,Nd143_Nd144,Pb206_Pb204,Pb207_Pb204,Pb208_Pb204)
is.na(OIB) <- sapply(OIB, is.infinite) #replace Inf by NA
OIB[OIB == 0] <- NA # Replace 0 with NA
OIB <- OIB[rowSums(is.na(OIB)) == 0,] # removes rows with missing info for PCA
s <- joined_data %>%
filter(Sample %in% c("K-12-25")) %>%
mutate(Location = case_when(grepl("K-12-25", Sample) ~ "K-12-25")) %>%
dplyr::select(Sample,Location,
Sr87_Sr86,Nd143_Nd144,Pb206_Pb204,Pb207_Pb204,Pb208_Pb204,Nd143_Nd144)
s[s == 0] <- NA # Replace 0 with NA
s <- s[rowSums(is.na(s)) == 0,] # removes rows with missing info for PCA
res.pca <- prcomp(OIB[,3:7], scale = TRUE, center = TRUE) # Dimension reduction using PCA
eig <- get_eig(res.pca)
K1225_PCA_1a <- fviz_pca_biplot(
res.pca, label = "var", col.var = "black", alpha.var = .2,
habillage = OIB$Location, fill.ind = OIB$Location,
pointsize = 2, invisible = "quali", labelsize = 3, repel = T) +
scale_shape_manual(values=shapes) + scale_fill_manual(values=cols) +
scale_color_manual(values=cols) +
scale_x_continuous(limits=c(-3, 2.5)) + scale_y_continuous(limits=c(-2, 2)) +
theme(panel.border = element_rect(colour = "black", fill=NA, size=1),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_rect(fill = "white"), title = element_blank(),
axis.title = element_text(size = 10), axis.text = element_text(size = 10),
legend.title = element_blank(), legend.text = element_text(size = 10),
legend.key.size = unit(.2, 'cm'), legend.position = "none", aspect.ratio=1)
K1225_PCA_1a
pdf(here("analysis","supplementary-materials","FigS14","FigS14-e-PCA.pdf"), width=3.5, height=3.5)
K1225_PCA_1a
dev.off()
pred <- stats::predict(res.pca, s[,3:7])
pred <- cbind(s[,1:2], pred)
res.pca.df <- cbind(OIB[,1:2], (as.data.frame(res.pca$x)))
d_pca <- full_join(res.pca.df, pred)
K1225_PCA_1b <- d_pca %>%
ggplot(aes(x=PC1,y=PC2, shape=factor(Location), fill=factor(Location),
color=factor(Location), group=Sample)) +
geom_vline(aes(xintercept = 0), size=.25, linetype="dashed") +
geom_hline(aes(yintercept = 0), size=.25, linetype="dashed") +
geom_point(size = 3, stroke=.25) + scale_shape_manual(values=shapes) +
scale_fill_manual(values=cols) + scale_color_manual(values=contour) +
scale_x_continuous(limits=c(-3, 2.5)) + scale_y_continuous(limits=c(-2, 2)) +
theme(panel.border = element_rect(colour = "black", fill=NA, size=.5),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_rect(fill = "white"), title = element_blank(),
axis.title = element_text(size = 9), axis.text = element_text(size = 8),
legend.position = "none", aspect.ratio=1) +
labs(x=paste0("PC1 (",round(eig["Dim.1","variance.percent"], digits = 1),"%)"),
y=paste0("PC2 (",round(eig["Dim.2","variance.percent"], digits = 1),"%)"))
K1225_PCA_1b
## PCs : density plots
PC1 <- ggplot(d_pca, aes(x = PC1, y = 0)) +
geom_density_ridges(aes(color=Location, fill=Location), alpha=0.4, size=.25) +
annotate("segment", x=d_pca[31,"PC1"], xend=d_pca[31,"PC1"],
y=0, yend=Inf, col="red", size=.75) +
scale_color_manual(values = cols) + scale_fill_manual(values = cols) +
scale_x_continuous(expand = c(0, 0)) + scale_y_continuous(expand = c(0, 0)) +
theme_void() + theme(
axis.title.y=element_text(size=7, margin=margin(r=0), hjust = 0),
axis.text.x=element_text(size=6), axis.line.x=element_line(size=.25),
axis.ticks.length.x=unit(.05,"cm"),
axis.ticks.x=element_line(size=.25, color="black"), legend.position="none") +
labs(y=paste0("PC1","\n","(",round(eig["Dim.1","variance.percent"], digits = 1),"%)"))
PC2 <- ggplot(d_pca, aes(x = PC2, y = 0)) +
geom_density_ridges(aes(color=Location, fill=Location), alpha=0.4, size=.25) +
annotate("segment", x=d_pca[31,"PC2"], xend=d_pca[31,"PC2"],
y=0, yend=Inf, col="red", size=.75) +
scale_color_manual(values = cols) + scale_fill_manual(values = cols) +
scale_x_continuous(expand = c(0, 0)) + scale_y_continuous(expand = c(0, 0)) +
theme_void() + theme(
axis.title.y=element_text(size=7, margin=margin(r=0), hjust = 0),
axis.text.x=element_text(size=6), axis.line.x=element_line(size=.25),
axis.ticks.length.x=unit(.05,"cm"),
axis.ticks.x=element_line(size=.25, color="black"), legend.position="none") +
labs(y=paste0("PC2","\n","(",round(eig["Dim.2","variance.percent"], digits = 1),"%)"))
PC3 <- ggplot(d_pca, aes(x = PC3, y = 0)) +
geom_density_ridges(aes(color=Location, fill=Location), alpha=0.4, size=.25) +
annotate("segment", x=d_pca[31,"PC3"], xend=d_pca[31,"PC3"],
y=0, yend=Inf, col="red", size=.75) +
scale_color_manual(values = cols) + scale_fill_manual(values = cols) +
scale_x_continuous(expand = c(0, 0)) + scale_y_continuous(expand = c(0, 0)) +
theme_void() + theme(
axis.title.y=element_text(size=7, margin=margin(r=0), hjust = 0),
axis.text.x=element_text(size=6), axis.line.x=element_line(size=.25),
axis.ticks.length.x=unit(.05,"cm"),
axis.ticks.x=element_line(size=.25, color="black"), legend.position="none") +
labs(y=paste0("PC3","\n","(",round(eig["Dim.3","variance.percent"], digits = 1),"%)"))
PC4 <- ggplot(d_pca, aes(x = PC4, y = 0)) +
geom_density_ridges(aes(color=Location, fill=Location), alpha=0.4, size=.25) +
annotate("segment", x=d_pca[31,"PC4"], xend=d_pca[31,"PC4"],
y=0, yend=Inf, col="red", size=.75) +
scale_color_manual(values = cols) + scale_fill_manual(values = cols) +
scale_x_continuous(expand = c(0, 0)) + scale_y_continuous(expand = c(0, 0)) +
theme_void() + theme(
axis.title.y=element_text(size=7, margin=margin(r=0), hjust = 0),
axis.text.x=element_text(size=6), axis.line.x=element_line(size=.25),
axis.ticks.length.x=unit(.05,"cm"),
axis.ticks.x=element_line(size=.25, color="black"), legend.position="none") +
labs(y=paste0("PC4","\n","(",round(eig["Dim.4","variance.percent"], digits = 1),"%)"))
PC5 <- ggplot(d_pca, aes(x = PC5, y = 0)) +
geom_density_ridges(aes(color=Location, fill=Location), alpha=0.4, size=.25) +
annotate("segment", x=d_pca[31,"PC5"], xend=d_pca[31,"PC5"],
y=0, yend=Inf, col="red", size=.75) +
scale_color_manual(values = cols) + scale_fill_manual(values = cols) +
scale_x_continuous(expand = c(0, 0)) + scale_y_continuous(expand = c(0, 0)) +
theme_void() + theme(
axis.title.y=element_text(size=7, margin=margin(r=0), hjust = 0),
axis.text.x=element_text(size=6), axis.line.x=element_line(size=.25),
axis.ticks.length.x=unit(.05,"cm"),
axis.ticks.x=element_line(size=.25, color="black"), legend.position="none") +
labs(y=paste0("PC5","\n","(",round(eig["Dim.5","variance.percent"], digits = 1),"%)"))
PCs <- PC1/PC2/PC3/PC4/PC5 & theme(plot.margin = unit(c(5,0,5,10), "pt"))
pdf(here("analysis","supplementary-materials","FigS14","FigS14-e.pdf"), width=6, height=3.5)
(K1225_PCA_1b | PCs) + plot_layout(widths = c(3.5, 2.5))
dev.off()
## K1225 PCA 2
OIB <- q17 %>% dplyr::select(
Sample,Location,SiO2,K2O,Na2O,Rb,Ba,Th,U,Nb,La,Ce,Nd,Sr,Sm,Zr,Ti,Eu,Gd,Y,Yb)
is.na(OIB) <- sapply(OIB, is.infinite) #replace Inf by NA
OIB[OIB == 0] <- NA # Replace 0 with NA
OIB <- OIB[rowSums(is.na(OIB)) == 0,] # removes rows with missing info for PCA
OIB %>% group_by(Location) %>% tally()
s <- joined_data %>% dplyr::filter(Sample %in% c("K-12-25")) %>%
mutate(Location = case_when(grepl("K-12-25", Sample) ~ "K-12-25")) %>%
dplyr::select(
Sample,Location,SiO2,K2O,Na2O,Rb,Ba,Th,U,Nb,La,Ce,Nd,Sr,Sm,Zr,Ti,Eu,Gd,Y,Yb)
s[s == 0] <- NA # Replace 0 with NA
s <- s[rowSums(is.na(s)) == 0,] # removes rows with missing info for PCA
res.pca <- prcomp(OIB[,3:21], scale = TRUE, center = TRUE) # Dimension reduction using PCA
eig <- get_eig(res.pca)
K1225_PCA_2a <- fviz_pca_biplot(
res.pca, label = "var", col.var = "black", alpha.var = .2,
habillage = OIB$Location, fill.ind = OIB$Location,
pointsize = 2, invisible = "quali", labelsize = 3, repel = T) +
scale_shape_manual(values=shapes) + scale_fill_manual(values=cols) +
scale_color_manual(values=cols) +
scale_x_continuous(limits=c(-8, 8)) + scale_y_continuous(limits=c(-4.5, 3)) +
theme(panel.border = element_rect(colour = "black", fill=NA, size=1),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_rect(fill = "white"), title = element_blank(),
axis.title = element_text(size = 10), axis.text = element_text(size = 10),
legend.title = element_blank(), legend.text = element_text(size = 10),
legend.key.size = unit(.2, 'cm'), legend.position = "none", aspect.ratio=1)
K1225_PCA_2a
pdf(here("analysis","supplementary-materials","FigS14","FigS14-f-PCA.pdf"), width=3.5, height=3.5)
K1225_PCA_2a
dev.off()
pred <- stats::predict(res.pca, s[,3:21])
pred <- cbind(s[,1:2], pred)
res.pca.df <- cbind(OIB[,1:2], (as.data.frame(res.pca$x)))
d_pca <- full_join(res.pca.df, pred)
K1225_PCA_2b <- d_pca %>%
ggplot(aes(x=PC1,y=PC2, shape=factor(Location), fill=factor(Location),
color=factor(Location), group=Sample)) +
geom_vline(aes(xintercept = 0), size=.25, linetype="dashed") +
geom_hline(aes(yintercept = 0), size=.25, linetype="dashed") +
geom_point(size = 3, stroke=.25) + scale_shape_manual(values=shapes) +
scale_fill_manual(values=cols) + scale_color_manual(values=contour) +
scale_x_continuous(limits=c(-8, 8)) + scale_y_continuous(limits=c(-4.5, 3)) +
theme(panel.border = element_rect(colour = "black", fill=NA, size=.5),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_rect(fill = "white"), title = element_blank(),
axis.title = element_text(size = 9), axis.text = element_text(size = 8),
legend.position = "none", aspect.ratio=1) +
labs(x=paste0("PC1 (",round(eig["Dim.1","variance.percent"], digits = 1),"%)"),
y=paste0("PC2 (",round(eig["Dim.2","variance.percent"], digits = 1),"%)"))
K1225_PCA_2b
## PCs : density plots
PC1 <- ggplot(d_pca, aes(x = PC1, y = 0)) +
geom_density_ridges(aes(color=Location, fill=Location), alpha=0.4, size=.25) +
annotate("segment", x=d_pca[116,"PC1"], xend=d_pca[116,"PC1"],
y=0, yend=Inf, col="red", size=.75) +
scale_color_manual(values = cols) + scale_fill_manual(values = cols) +
scale_x_continuous(expand = c(0, 0)) + scale_y_continuous(expand = c(0, 0)) +
theme_void() + theme(
axis.title.y=element_text(size=7, margin=margin(r=0), hjust = 0),
axis.text.x=element_text(size=6), axis.line.x=element_line(size=.25),
axis.ticks.length.x=unit(.05,"cm"),
axis.ticks.x=element_line(size=.25, color="black"), legend.position="none") +
labs(y=paste0("PC1","\n","(",round(eig["Dim.1","variance.percent"], digits = 1),"%)"))
PC2 <- ggplot(d_pca, aes(x = PC2, y = 0)) +
geom_density_ridges(aes(color=Location, fill=Location), alpha=0.4, size=.25) +
annotate("segment", x=d_pca[116,"PC2"], xend=d_pca[116,"PC2"],
y=0, yend=Inf, col="red", size=.75) +
scale_color_manual(values = cols) + scale_fill_manual(values = cols) +
scale_x_continuous(expand = c(0, 0)) + scale_y_continuous(expand = c(0, 0)) +
theme_void() + theme(
axis.title.y=element_text(size=7, margin=margin(r=0), hjust = 0),
axis.text.x=element_text(size=6), axis.line.x=element_line(size=.25),
axis.ticks.length.x=unit(.05,"cm"),
axis.ticks.x=element_line(size=.25, color="black"), legend.position="none") +
labs(y=paste0("PC2","\n","(",round(eig["Dim.2","variance.percent"], digits = 1),"%)"))
PC3 <- ggplot(d_pca, aes(x = PC3, y = 0)) +
geom_density_ridges(aes(color=Location, fill=Location), alpha=0.4, size=.25) +
annotate("segment", x=d_pca[116,"PC3"], xend=d_pca[116,"PC3"],
y=0, yend=Inf, col="red", size=.75) +
scale_color_manual(values = cols) + scale_fill_manual(values = cols) +
scale_x_continuous(expand = c(0, 0)) + scale_y_continuous(expand = c(0, 0)) +
theme_void() + theme(
axis.title.y=element_text(size=7, margin=margin(r=0), hjust = 0),
axis.text.x=element_text(size=6), axis.line.x=element_line(size=.25),
axis.ticks.length.x=unit(.05,"cm"),
axis.ticks.x=element_line(size=.25, color="black"), legend.position="none") +
labs(y=paste0("PC3","\n","(",round(eig["Dim.3","variance.percent"], digits = 1),"%)"))
PC4 <- ggplot(d_pca, aes(x = PC4, y = 0)) +
geom_density_ridges(aes(color=Location, fill=Location), alpha=0.4, size=.25) +
annotate("segment", x=d_pca[116,"PC4"], xend=d_pca[116,"PC4"],
y=0, yend=Inf, col="red", size=.75) +
scale_color_manual(values = cols) + scale_fill_manual(values = cols) +
scale_x_continuous(expand = c(0, 0)) + scale_y_continuous(expand = c(0, 0)) +
theme_void() + theme(
axis.title.y=element_text(size=7, margin=margin(r=0), hjust = 0),
axis.text.x=element_text(size=6), axis.line.x=element_line(size=.25),
axis.ticks.length.x=unit(.05,"cm"),
axis.ticks.x=element_line(size=.25, color="black"), legend.position="none") +
labs(y=paste0("PC4","\n","(",round(eig["Dim.4","variance.percent"], digits = 1),"%)"))
PC5 <- ggplot(d_pca, aes(x = PC5, y = 0)) +
geom_density_ridges(aes(color=Location, fill=Location), alpha=0.4, size=.25) +
annotate("segment", x=d_pca[116,"PC5"], xend=d_pca[116,"PC5"],
y=0, yend=Inf, col="red", size=.75) +
scale_color_manual(values = cols) + scale_fill_manual(values = cols) +
scale_x_continuous(expand = c(0, 0)) + scale_y_continuous(expand = c(0, 0)) +
theme_void() + theme(
axis.title.y=element_text(size=7, margin=margin(r=0), hjust = 0),
axis.text.x=element_text(size=6), axis.line.x=element_line(size=.25),
axis.ticks.length.x=unit(.05,"cm"),
axis.ticks.x=element_line(size=.25, color="black"), legend.position="none") +
labs(y=paste0("PC5","\n","(",round(eig["Dim.5","variance.percent"], digits = 1),"%)"))
PCs <- PC1/PC2/PC3/PC4/PC5 & theme(plot.margin = unit(c(5,0,5,10), "pt"))
pdf(here("analysis","supplementary-materials","FigS14","FigS14-f.pdf"), width=6, height=3.5)
(K1225_PCA_2b | PCs) + plot_layout(widths = c(3.5, 2.5))
dev.off()
#### Fig 14g ####
## K1226 PCA 1
OIB <- q18 %>% dplyr::select(
Sample,Location,Sr87_Sr86,Nd143_Nd144,Pb206_Pb204,Pb207_Pb204,Pb208_Pb204)
is.na(OIB) <- sapply(OIB, is.infinite) #replace Inf by NA
OIB[OIB == 0] <- NA # Replace 0 with NA
OIB <- OIB[rowSums(is.na(OIB)) == 0,] # removes rows with missing info for PCA
s <- joined_data %>%
filter(Sample %in% c("K-12-26")) %>%
mutate(Location = case_when(grepl("K-12-26", Sample) ~ "K-12-26")) %>%
dplyr::select(Sample,Location,
Sr87_Sr86,Nd143_Nd144,Pb206_Pb204,Pb207_Pb204,Pb208_Pb204,Nd143_Nd144)
s[s == 0] <- NA # Replace 0 with NA
s <- s[rowSums(is.na(s)) == 0,] # removes rows with missing info for PCA
res.pca <- prcomp(OIB[,3:7], scale = TRUE, center = TRUE) # Dimension reduction using PCA
eig <- get_eig(res.pca)
K1226_PCA_1a <- fviz_pca_biplot(
res.pca, label = "var", col.var = "black", alpha.var = .2,
habillage = OIB$Location, fill.ind = OIB$Location,
pointsize = 2, invisible = "quali", labelsize = 3, repel = T) +
scale_shape_manual(values=shapes) + scale_fill_manual(values=cols) +
scale_color_manual(values=cols) +
scale_x_continuous(limits=c(-7.5, 3.5)) + scale_y_continuous(limits=c(-3.5, 3.5)) +
theme(panel.border = element_rect(colour = "black", fill=NA, size=1),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_rect(fill = "white"), title = element_blank(),
axis.title = element_text(size = 10), axis.text = element_text(size = 10),
legend.title = element_blank(), legend.text = element_text(size = 10),
legend.key.size = unit(.2, 'cm'), legend.position = "none", aspect.ratio=1)
K1226_PCA_1a
pdf(here("analysis","supplementary-materials","FigS14","FigS14-g-PCA.pdf"), width=3.5, height=3.5)
K1226_PCA_1a
dev.off()
pred <- stats::predict(res.pca, s[,3:7])
pred <- cbind(s[,1:2], pred)
res.pca.df <- cbind(OIB[,1:2], (as.data.frame(res.pca$x)))
d_pca <- full_join(res.pca.df, pred)
K1226_PCA_1b <- d_pca %>%
ggplot(aes(x=PC1,y=PC2, shape=factor(Location), fill=factor(Location),
color=factor(Location), group=Sample)) +
geom_vline(aes(xintercept = 0), size=.25, linetype="dashed") +
geom_hline(aes(yintercept = 0), size=.25, linetype="dashed") +
geom_point(size = 3, stroke=.25) + scale_shape_manual(values=shapes) +
scale_fill_manual(values=cols) + scale_color_manual(values=contour) +
scale_x_continuous(limits=c(-7.5, 3.5)) + scale_y_continuous(limits=c(-3.5, 3.5)) +
theme(panel.border = element_rect(colour = "black", fill=NA, size=.5),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_rect(fill = "white"), title = element_blank(),
axis.title = element_text(size = 9), axis.text = element_text(size = 8),
legend.position = "none", aspect.ratio=1) +
labs(x=paste0("PC1 (",round(eig["Dim.1","variance.percent"], digits = 1),"%)"),
y=paste0("PC2 (",round(eig["Dim.2","variance.percent"], digits = 1),"%)"))
K1226_PCA_1b
PC1 <- ggplot(d_pca, aes(x = PC1, y = 0)) +
geom_density_ridges(aes(color=Location, fill=Location), alpha=0.4, size=.25) +
annotate("segment", x=d_pca[85,"PC1"], xend=d_pca[85,"PC1"],
y=0, yend=Inf, col="red", size=.75) +
scale_color_manual(values = cols) + scale_fill_manual(values = cols) +
scale_x_continuous(expand = c(0, 0)) + scale_y_continuous(expand = c(0, 0)) +
theme_void() + theme(
axis.title.y=element_text(size=7, margin=margin(r=0), hjust = 0),
axis.text.x=element_text(size=6), axis.line.x=element_line(size=.25),
axis.ticks.length.x=unit(.05,"cm"),
axis.ticks.x=element_line(size=.25, color="black"), legend.position="none") +
labs(y=paste0("PC1","\n","(",round(eig["Dim.1","variance.percent"], digits = 1),"%)"))
PC2 <- ggplot(d_pca, aes(x = PC2, y = 0)) +
geom_density_ridges(aes(color=Location, fill=Location), alpha=0.4, size=.25) +
annotate("segment", x=d_pca[85,"PC2"], xend=d_pca[85,"PC2"],
y=0, yend=Inf, col="red", size=.75) +
scale_color_manual(values = cols) + scale_fill_manual(values = cols) +
scale_x_continuous(expand = c(0, 0)) + scale_y_continuous(expand = c(0, 0)) +
theme_void() + theme(
axis.title.y=element_text(size=7, margin=margin(r=0), hjust = 0),
axis.text.x=element_text(size=6), axis.line.x=element_line(size=.25),
axis.ticks.length.x=unit(.05,"cm"),
axis.ticks.x=element_line(size=.25, color="black"), legend.position="none") +
labs(y=paste0("PC2","\n","(",round(eig["Dim.2","variance.percent"], digits = 1),"%)"))
PC3 <- ggplot(d_pca, aes(x = PC3, y = 0)) +
geom_density_ridges(aes(color=Location, fill=Location), alpha=0.4, size=.25) +
annotate("segment", x=d_pca[85,"PC3"], xend=d_pca[85,"PC3"],
y=0, yend=Inf, col="red", size=.75) +
scale_color_manual(values = cols) + scale_fill_manual(values = cols) +
scale_x_continuous(expand = c(0, 0)) + scale_y_continuous(expand = c(0, 0)) +
theme_void() + theme(
axis.title.y=element_text(size=7, margin=margin(r=0), hjust = 0),
axis.text.x=element_text(size=6), axis.line.x=element_line(size=.25),
axis.ticks.length.x=unit(.05,"cm"),
axis.ticks.x=element_line(size=.25, color="black"), legend.position="none") +
labs(y=paste0("PC3","\n","(",round(eig["Dim.3","variance.percent"], digits = 1),"%)"))
PC4 <- ggplot(d_pca, aes(x = PC4, y = 0)) +
geom_density_ridges(aes(color=Location, fill=Location), alpha=0.4, size=.25) +
annotate("segment", x=d_pca[85,"PC4"], xend=d_pca[85,"PC4"],
y=0, yend=Inf, col="red", size=.75) +
scale_color_manual(values = cols) + scale_fill_manual(values = cols) +
scale_x_continuous(expand = c(0, 0)) + scale_y_continuous(expand = c(0, 0)) +
theme_void() + theme(
axis.title.y=element_text(size=7, margin=margin(r=0), hjust = 0),
axis.text.x=element_text(size=6), axis.line.x=element_line(size=.25),
axis.ticks.length.x=unit(.05,"cm"),
axis.ticks.x=element_line(size=.25, color="black"), legend.position="none") +
labs(y=paste0("PC4","\n","(",round(eig["Dim.4","variance.percent"], digits = 1),"%)"))
PC5 <- ggplot(d_pca, aes(x = PC5, y = 0)) +
geom_density_ridges(aes(color=Location, fill=Location), alpha=0.4, size=.25) +
annotate("segment", x=d_pca[85,"PC5"], xend=d_pca[85,"PC5"],
y=0, yend=Inf, col="red", size=.75) +
scale_color_manual(values = cols) + scale_fill_manual(values = cols) +
scale_x_continuous(expand = c(0, 0)) + scale_y_continuous(expand = c(0, 0)) +
theme_void() + theme(
axis.title.y=element_text(size=7, margin=margin(r=0), hjust = 0),
axis.text.x=element_text(size=6), axis.line.x=element_line(size=.25),
axis.ticks.length.x=unit(.05,"cm"),
axis.ticks.x=element_line(size=.25, color="black"), legend.position="none") +
labs(y=paste0("PC5","\n","(",round(eig["Dim.5","variance.percent"], digits = 1),"%)"))
PCs <- PC1/PC2/PC3/PC4/PC5 & theme(plot.margin = unit(c(5,0,5,10), "pt"))
pdf(here("analysis","supplementary-materials","FigS14","FigS14-g.pdf"), width=6, height=3.5)
(K1226_PCA_1b | PCs) + plot_layout(widths = c(3.5, 2.5))
dev.off()
OIB <- q19 %>% dplyr::select(
Sample,Location,SiO2,K2O,Na2O,Rb,Ba,Th,U,Nb,La,Ce,Nd,Sr,Sm,Zr,Ti,Eu,Gd,Y,Yb)
is.na(OIB) <- sapply(OIB, is.infinite) #replace Inf by NA
OIB[OIB == 0] <- NA # Replace 0 with NA
OIB <- OIB[rowSums(is.na(OIB)) == 0,] # removes rows with missing info for PCA
s <- joined_data %>%
dplyr::filter(Sample %in% c("K-12-26")) %>%
mutate(Location = case_when(grepl("K-12-26", Sample) ~ "K-12-26")) %>%
dplyr::select(
Sample,Location,SiO2,K2O,Na2O,Rb,Ba,Th,U,Nb,La,Ce,Nd,Sr,Sm,Zr,Ti,Eu,Gd,Y,Yb)
s[s == 0] <- NA # Replace 0 with NA
s <- s[rowSums(is.na(s)) == 0,] # removes rows with missing info for PCA
res.pca <- prcomp(OIB[,3:21], scale = TRUE, center = TRUE) # Dimension reduction using PCA
eig <- get_eig(res.pca)
K1226_PCA_2a <- fviz_pca_biplot(
res.pca, label = "var", col.var = "black", alpha.var = .2,
habillage = OIB$Location, fill.ind = OIB$Location,
pointsize = 2, invisible = "quali", labelsize = 3, repel = T) +
scale_shape_manual(values=shapes) + scale_fill_manual(values=cols) +
scale_color_manual(values=cols) +
scale_x_continuous(limits=c(-10, 8)) + scale_y_continuous(limits=c(-3, 6)) +
theme(panel.border = element_rect(colour = "black", fill=NA, size=1),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_rect(fill = "white"), title = element_blank(),
axis.title = element_text(size = 10), axis.text = element_text(size = 10),
legend.title = element_blank(), legend.text = element_text(size = 10),
legend.key.size = unit(.2, 'cm'), legend.position = "none", aspect.ratio=1)
K1226_PCA_2a
pdf(here("analysis","supplementary-materials","FigS14","FigS14-h-PCA.pdf"), width=3.5, height=3.5)
K1226_PCA_2a
dev.off()
pred <- stats::predict(res.pca, s[,3:21])
pred <- cbind(s[,1:2], pred)
res.pca.df <- cbind(OIB[,1:2], (as.data.frame(res.pca$x)))
d_pca <- full_join(res.pca.df, pred)
K1226_PCA_2b <- d_pca %>%
ggplot(aes(x=PC1,y=PC2, shape=factor(Location), fill=factor(Location),
color=factor(Location), group=Sample)) +
geom_vline(aes(xintercept = 0), size=.25, linetype="dashed") +
geom_hline(aes(yintercept = 0), size=.25, linetype="dashed") +
geom_point(size = 3, stroke=.25) + scale_shape_manual(values=shapes) +
scale_fill_manual(values=cols) + scale_color_manual(values=contour) +
scale_x_continuous(limits=c(-10, 8)) + scale_y_continuous(limits=c(-3, 6)) +
theme(panel.border = element_rect(colour = "black", fill=NA, size=.5),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_rect(fill = "white"), title = element_blank(),
axis.title = element_text(size = 9), axis.text = element_text(size = 8),
legend.position = "none", aspect.ratio=1) +
labs(x=paste0("PC1 (",round(eig["Dim.1","variance.percent"], digits = 1),"%)"),
y=paste0("PC2 (",round(eig["Dim.2","variance.percent"], digits = 1),"%)"))
K1226_PCA_2b
## PCs : density plots
PC1 <- ggplot(d_pca, aes(x = PC1, y = 0)) +
geom_density_ridges(aes(color=Location, fill=Location), alpha=0.4, size=.25) +
annotate("segment", x=d_pca[78,"PC1"], xend=d_pca[78,"PC1"],
y=0, yend=Inf, col="red", size=.75) +
scale_color_manual(values = cols) + scale_fill_manual(values = cols) +
scale_x_continuous(expand = c(0, 0)) + scale_y_continuous(expand = c(0, 0)) +
theme_void() + theme(
axis.title.y=element_text(size=7, margin=margin(r=0), hjust = 0),
axis.text.x=element_text(size=6), axis.line.x=element_line(size=.25),
axis.ticks.length.x=unit(.05,"cm"),
axis.ticks.x=element_line(size=.25, color="black"), legend.position="none") +
labs(y=paste0("PC1","\n","(",round(eig["Dim.1","variance.percent"], digits = 1),"%)"))
PC2 <- ggplot(d_pca, aes(x = PC2, y = 0)) +
geom_density_ridges(aes(color=Location, fill=Location), alpha=0.4, size=.25) +
annotate("segment", x=d_pca[78,"PC2"], xend=d_pca[78,"PC2"],
y=0, yend=Inf, col="red", size=.75) +
scale_color_manual(values = cols) + scale_fill_manual(values = cols) +
scale_x_continuous(expand = c(0, 0)) + scale_y_continuous(expand = c(0, 0)) +
theme_void() + theme(
axis.title.y=element_text(size=7, margin=margin(r=0), hjust = 0),
axis.text.x=element_text(size=6), axis.line.x=element_line(size=.25),
axis.ticks.length.x=unit(.05,"cm"),
axis.ticks.x=element_line(size=.25, color="black"), legend.position="none") +
labs(y=paste0("PC2","\n","(",round(eig["Dim.2","variance.percent"], digits = 1),"%)"))
PC3 <- ggplot(d_pca, aes(x = PC3, y = 0)) +
geom_density_ridges(aes(color=Location, fill=Location), alpha=0.4, size=.25) +
annotate("segment", x=d_pca[78,"PC3"], xend=d_pca[78,"PC3"],
y=0, yend=Inf, col="red", size=.75) +
scale_color_manual(values = cols) + scale_fill_manual(values = cols) +
scale_x_continuous(expand = c(0, 0)) + scale_y_continuous(expand = c(0, 0)) +
theme_void() + theme(
axis.title.y=element_text(size=7, margin=margin(r=0), hjust = 0),
axis.text.x=element_text(size=6), axis.line.x=element_line(size=.25),
axis.ticks.length.x=unit(.05,"cm"),
axis.ticks.x=element_line(size=.25, color="black"), legend.position="none") +
labs(y=paste0("PC3","\n","(",round(eig["Dim.3","variance.percent"], digits = 1),"%)"))
PC4 <- ggplot(d_pca, aes(x = PC4, y = 0)) +
geom_density_ridges(aes(color=Location, fill=Location), alpha=0.4, size=.25) +
annotate("segment", x=d_pca[78,"PC4"], xend=d_pca[78,"PC4"],
y=0, yend=Inf, col="red", size=.75) +
scale_color_manual(values = cols) + scale_fill_manual(values = cols) +
scale_x_continuous(expand = c(0, 0)) + scale_y_continuous(expand = c(0, 0)) +
theme_void() + theme(
axis.title.y=element_text(size=7, margin=margin(r=0), hjust = 0),
axis.text.x=element_text(size=6), axis.line.x=element_line(size=.25),
axis.ticks.length.x=unit(.05,"cm"),
axis.ticks.x=element_line(size=.25, color="black"), legend.position="none") +
labs(y=paste0("PC4","\n","(",round(eig["Dim.4","variance.percent"], digits = 1),"%)"))
PC5 <- ggplot(d_pca, aes(x = PC5, y = 0)) +
geom_density_ridges(aes(color=Location, fill=Location), alpha=0.4, size=.25) +
annotate("segment", x=d_pca[78,"PC5"], xend=d_pca[78,"PC5"],
y=0, yend=Inf, col="red", size=.75) +
scale_color_manual(values = cols) + scale_fill_manual(values = cols) +
scale_x_continuous(expand = c(0, 0)) + scale_y_continuous(expand = c(0, 0)) +
theme_void() + theme(
axis.title.y=element_text(size=7, margin=margin(r=0), hjust = 0),
axis.text.x=element_text(size=6), axis.line.x=element_line(size=.25),
axis.ticks.length.x=unit(.05,"cm"),
axis.ticks.x=element_line(size=.25, color="black"), legend.position="none") +
labs(y=paste0("PC5","\n","(",round(eig["Dim.5","variance.percent"], digits = 1),"%)"))
PCs <- PC1/PC2/PC3/PC4/PC5 & theme(plot.margin = unit(c(5,0,5,10), "pt"))
pdf(here("analysis","supplementary-materials","FigS14","FigS14-h.pdf"), width=6, height=3.5)
(K1226_PCA_2b | PCs) + plot_layout(widths = c(3.5, 2.5))
dev.off()
source("~/Documents/Github/polynesianoutliersvoyaging/analysis/sql-queries.R")
